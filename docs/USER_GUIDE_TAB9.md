# ステップ9: 高度な分析 - ユーザーガイド

## 📘 はじめに

このガイドは、データ分析の専門知識がない方でも「ステップ9: 高度な分析」の機能を理解し、活用できるようにすることを目的としています。

## 🎯 高度な分析で何ができるか？

ステップ7までの分析（PageRank、中心性）は**相関**を見ています。
ステップ9の分析は、その一歩先の**因果関係**や**統計的信頼性**を明らかにします。

### なぜ必要なのか？

**例**: PageRankで「工程A」が重要と判明しました。しかし...

- **本当に重要？** それとも偶然？ → **Bootstrap統計検定**で確認
- **なぜ重要？** 実際にどう影響している？ → **Transfer Entropy**で因果を確認
- **どれくらい重要？** 他の工程と比べて？ → **Shapley Value**で公平に評価

---

## 📊 各分析の詳細ガイド

### 1. Shapley Value（協力貢献度分析）⭐ 推奨

#### 何がわかるか

「この工程を削除したら、全体の性能がどれだけ下がるか」を**公平に**評価します。

**例**:
- 工程Aを削除 → 性能10%低下
- 工程Bを削除 → 性能3%低下
→ **工程Aの方が重要**

#### どう使えばいいか

**使用場面**:
1. **投資優先順位の決定**: Shapley値が高い工程から改善
2. **見えにくい貢献の発見**: 「縁の下の力持ち」を可視化
3. **リソース配分**: 貢献度に応じた予算配分

**具体例**:
- 製造プロセスで、どの工程に自動化設備を導入すべきか？
→ Shapley値上位3工程を優先

#### 結果の見方

**Shapley値が高い** = 全体への貢献が大きい
- 上位10ノードを重点管理対象とする
- 累積貢献度グラフで「上位何ノードで80%か」を確認

**負の値がある場合** = 削除すると全体が改善する可能性
- プロセスの再設計を検討

#### パラメータ設定

- **サンプル数**: 1000（推奨）
  - 少ない（500）: 高速だが精度低下
  - 多い（3000）: 精度向上だが時間増加

- **価値関数**: PageRank合計（推奨）
  - PageRank: 影響力の総和
  - 効率性: 最短経路の効率
  - 接続性: エッジ数

#### 連携安定性分析

**何がわかるか**:
- Shapley値上位25%のノード間の連携強度
- 密結合ペア（接続が強い組み合わせ）Top10
- 連携を強化すべき優先ペア

**どう使えばいいか**:
1. **協業プロジェクトの設計**: 密結合ペアを同じチーム/プロジェクトに配置
2. **連携強化施策**: 上位ノード間のコミュニケーション・情報共有の仕組み構築
3. **相乗効果の最大化**: 単独改善ではなく、連携改善で効果を倍増

**結果の見方**:
- **ネットワーク図**: ノードサイズ = Shapley値、エッジ太さ = 接続強度
- **密結合ペアがない場合**: 疎なネットワーク → 各ノードが独立に機能
- **密結合ペアが多い場合**: 密なネットワーク → 連携が重要

**具体例**:
- 製造プロセス: 「設計」と「試作」が密結合 → 設計試作の一体化チーム編成
- サービス業: 「窓口」と「事務処理」が密結合 → ワンストップサービス導入

---

### 2. Transfer Entropy（情報フロー分析）⭐ 推奨

#### 何がわかるか

「誰が誰に何bit情報を伝えているか」を定量化します。

**相関との違い**:
- 相関: A↑のとき、B↑（同時変動）
- Transfer Entropy: Aの変化が**原因**でBが変化

**例**:
- 元の評価スコア: 工程A → 工程B = 5点
- Transfer Entropy: 工程A → 工程B = 0.05 bits

→ 評価は高いが、**実際の因果的影響は弱い**（見かけの相関）

#### どう使えばいいか

**使用場面**:
1. **真のボトルネック特定**: 情報が集中・遮断される箇所
2. **コミュニケーション設計**: 情報フローが弱い箇所に仕組み構築
3. **評価の見直し**: 「見かけの相関」ペアを再評価

**具体例**:
- 「工程Bは重要」と思っていたが、Transfer Entropyは低い
→ 実際には他の工程経由で間接的に影響しているだけ

#### 結果の見方

**TE行列ヒートマップ**: 
- 色が濃い = 強い因果的影響
- 元の隣接行列と並べて比較

**有意な情報フロー**:
- 上位20ペアが真の因果関係

**ボトルネックノード**:
- 多くの情報が集中・経由する中継点
- ここが停止すると情報の流れが遮断

**比較表**:
- ⬆️ 隠れた影響: 評価スコア低いがTE高い
- ⬇️ 見かけの相関: 評価スコア高いがTE低い

#### パラメータ設定

- **ランダムウォーク回数**: 1000（推奨）
- **ウォーク長**: 50（推奨）
- **離散化ビン数**: 3（低/中/高）

---

### 3. Bootstrap統計検定

#### 何がわかるか

「この結果は偶然ではない」という**統計的根拠**を提供します。

全ての指標に**信頼区間**と**有意性検定**を適用。

**例**:
- PageRank: 工程A = 0.35
- Bootstrap信頼区間: 0.30～0.40（95%）

→ 真の値は95%の確率で0.30～0.40の範囲

#### どう使えばいいか

**使用場面**:
1. **分析結果の信頼性評価**: どの結果が信頼できるか
2. **経営層への説明**: 統計的根拠付きで説得力UP
3. **再評価箇所の特定**: 信頼区間が広い箇所

**具体例**:
- 上司に「工程Aが重要です」と報告
- 「本当に？」と聞かれたら
→ 「95%信頼区間で0.30～0.40、統計的に有意です（p<0.05）」

#### 結果の見方

**信頼区間が狭い** = データが安定、信頼できる
- 相対誤差 < 20%: ✅ 安定

**信頼区間が広い** = 再評価推奨
- 相対誤差 > 50%: ❌ 不安定

**グループ間比較**:
- p値 < 0.05: 統計的に有意な差がある
- p値 >= 0.05: 差があるとは言えない

#### パラメータ設定

- **リサンプル回数**: 1000（推奨）
  - 多いほど精度向上

- **有意水準**: 0.05（95%信頼区間）
  - 0.01: 99%信頼区間（厳格）
  - 0.10: 90%信頼区間（緩い）

---

### 4. Bayesian Inference（不確実性定量化）

#### 何がわかるか

LLM評価の「信頼性」を数値化し、不確実性を定量化します。

**例**:
- エッジA→B: 事後平均 5.0, 95%信用区間 [4.0, 6.0]
- エッジC→D: 事後平均 3.0, 95%信用区間 [1.0, 5.0]
→ **エッジC→Dは不確実性が高く、再評価推奨**

#### どう使えばいいか

**使用場面**:
1. **再評価箇所の特定**: 信用区間が広いエッジを優先的に再評価
2. **リスク評価**: 重要な意思決定における不確実性を考慮
3. **シナリオ分析**: 信用区間の下限・上限を用いた楽観/悲観シナリオ

**具体例**:
- 意思決定に関わる重要なエッジの不確実性を確認
→ 不確実性が高い場合は追加の専門家意見を収集

#### 結果の見方

**不確実性スコアが低い** (< 0.3) = 評価が安定、信頼できる
- そのまま使用してOK

**不確実性スコアが高い** (> 0.5) = 評価が不安定、再評価推奨
- 追加データの収集または再評価が必要

**信用区間**:
- 95%信用区間 [下限, 上限]: 真の値が95%の確率でこの範囲内
- 区間が狭い = 安定、区間が広い = 不安定

#### パラメータ設定

- **Bootstrapサンプル数**: 1000（推奨）
  - 多いほど精度向上（計算時間増加）

- **信用区間レベル**: 95%（推奨）
  - 90%: 緩い基準
  - 99%: 厳格な基準

---

### 5. Graph Embedding（潜在構造発見）

#### 何がわかるか

ネットワークの潜在的な構造（コミュニティ、クラスター）を発見します。

**例**:
- コミュニティ1: {工程A, 工程B, 工程C}
- コミュニティ2: {工程D, 工程E}
→ **工程A-B-Cは密接に関連、D-Eは別グループ**

#### どう使えばいいか

**使用場面**:
1. **モジュール分割**: コミュニティごとに責任者を割り当て
2. **類似工程の発見**: 埋め込み空間で近いノードは同じ役割
3. **階層的プロセス理解**: 2D可視化でプロセスの全体像を把握

**具体例**:
- 製造プロセスで自然なグループを発見
→ グループごとに改善チームを編成

#### 結果の見方

**コミュニティ検出**:
- Modularity > 0.3: 明確なコミュニティ構造あり
- Modularity < 0.3: コミュニティ構造は弱い

**2D埋め込み**:
- 近いノード = 類似した役割・機能
- 離れたノード = 異なる役割

**類似度ランキング**:
- 上位ペアは機能的に似ている工程

#### パラメータ設定

- **埋め込み次元**: 64（推奨）
  - 小さい（32）: 高速だが精度低下
  - 大きい（128）: 精度向上だが計算時間増加

- **ランダムウォーク回数**: 1000（推奨）
- **ウォーク長**: 20（推奨）

---

### 6. Fisher Information（感度分析）

#### 何がわかるか

「どのエッジが不正確だと全体が大きく歪むか」を定量化します。

**例**:
- エッジA→B: 感度スコア 10.0
- エッジC→D: 感度スコア 2.0
→ **エッジA→Bの方が影響大、優先的に再評価**

#### どう使えばいいか

**使用場面**:
1. **再評価の優先順位決定**: 感度スコアが高いエッジから再評価
2. **データ収集計画**: 感度が高い箇所の追加データを収集
3. **信頼性評価**: 条件数で数値安定性を確認

**具体例**:
- 感度スコア上位5エッジを重点的に再評価
→ 全体の推定精度が大幅に向上

#### 結果の見方

**感度スコアが高い** = そのエッジが不正確だと全体が歪む
- 優先的に再評価すべき

**Cramér-Rao下限**:
- 推定精度の理論限界
- 下限が大きい = 推定が本質的に困難

**条件数**:
- < 10: 数値的に安定
- 10-100: やや不安定
- > 100: 数値的に不安定（多重共線性の可能性）

#### パラメータ設定

- **ノイズ分散（σ²）**: 1.0（推奨）
  - 小さい: Fisher情報が大きくなる（影響過大評価）
  - 大きい: Fisher情報が小さくなる（影響過小評価）

- **表示する上位エッジ数**: 20（推奨）

---

## 🔄 分析の組み合わせ方（推奨ワークフロー）

### ステップ1: PageRank/Betweennessで候補を絞る（タブ7）

重要そうなノードを10個程度リストアップ

### ステップ2: Bootstrap統計検定で信頼性を確認（タブ9.3）

→ 統計的に安定した上位5ノードに絞る

### ステップ3: Bayesian Inferenceで不確実性を確認（タブ9.4）

→ 不確実性が高いエッジを特定、再評価を検討

### ステップ4: Transfer Entropyで因果を確認（タブ9.2）

→ 「見かけの相関」を除外、真の因果関係のみ残す

### ステップ5: Shapley Valueで公平に評価（タブ9.1）

→ 最終的な投資優先順位を決定

### 補助的分析:

- **Graph Embedding（タブ9.6）**: プロセスのモジュール構造を理解
- **Fisher Information（タブ9.7）**: 再評価の優先順位をさらに精緻化

---

## 📊 7手法の比較表

| 分析手法 | 目的 | 計算時間 | 推奨度 | 主な用途 |
|---------|------|---------|--------|---------|
| Shapley Value | 協力貢献度 | 2-5分 | ⭐⭐⭐ | 投資優先順位決定 |
| Transfer Entropy | 因果情報フロー | 3-7分 | ⭐⭐⭐ | ボトルネック特定 |
| Bootstrap | 統計的信頼性 | 2-4分 | ⭐⭐⭐ | 結果の信頼性確認 |
| **Bayesian Inference** | **不確実性定量化** | **1-2分** | **⭐⭐** | **再評価箇所特定** |
| Causal Inference | 介入効果予測 | 3-7分 | ⭐⭐ | 改善シミュレーション |
| Graph Embedding | 潜在構造発見 | 2-4分 | ⭐⭐ | モジュール分割 |
| Fisher Information | 感度分析 | <1分 | ⭐⭐ | 再評価優先順位 |

---

## ❓ よくある質問（FAQ）

### Q1: どの分析から始めればいい？

**A**: まず**Bootstrap統計検定**で、既存の分析結果（PageRank等）の信頼性を確認してください。その後、**Shapley Value**で重要度を再評価することをお勧めします。

### Q2: 計算時間が長い場合は？

**A**: パラメータを調整してください:
- Shapley: サンプル数 1000 → 500
- TE: ウォーク回数 1000 → 500
- Bootstrap: リサンプル 1000 → 500

精度は若干下がりますが、3-5分 → 1-2分に短縮できます。

### Q3: 結果が直感と違う場合は？

**A**: それこそがこれらの分析の価値です。
- **相関≠因果**: Transfer Entropyで因果を確認
- **単独評価≠協力評価**: Shapley Valueは他との組み合わせも考慮
- **主観≠統計**: Bootstrapは客観的な信頼性を示す

違いがある場合は、なぜそうなるかを調査すると新しい発見があります。

### Q4: エクスポート機能は？

**A**: サイドバーの「📤 高度な分析結果エクスポート」から、Excel/JSON形式でダウンロードできます。

---

## 📚 参考資料

### 学術的背景

- **Shapley Value**: Shapley, L. S. (1953). "A value for n-person games"
- **Transfer Entropy**: Schreiber, T. (2000). "Measuring information transfer"
- **Bootstrap**: Efron, B. (1979). "Bootstrap methods: Another look at the jackknife"

### 実務応用例

- 製造業: 工程改善の優先順位決定
- サービス業: ボトルネック工程の特定
- R&D: リソース配分の最適化

---

## 🆘 サポート

質問や不明点がある場合は、以下を確認してください:

1. **各分析の「💡 この分析について」**: 基本説明
2. **「💡 結果の解釈」**: 自動生成される平易な説明
3. **このガイド**: 詳細な使用方法

それでも解決しない場合は、開発チームにお問い合わせください。

---

**バージョン**: 1.0.0  
**最終更新**: 2025-10-21
