# PIMアプリケーション 手動動作確認ガイド

このガイドに従って、ブラウザでPIMアプリケーションの動作を確認してください。

## 前提条件

サーバーが起動していること：
```bash
NETWORKMAPS_RELEASE=true streamlit run app_tabs.py
```

ブラウザで http://localhost:8501 にアクセス

## 確認手順

### ✅ タブ1: プロセス定義

1. タブ1「ステップ1: プロセス定義」を開く
2. 以下を入力：
   - **プロセス名**: コーヒー豆の焙煎・包装プロセス
   - **プロセス概要**: 生のコーヒー豆を焙煎し、品質検査を行い、包装して出荷するプロセス。主な工程は、焙煎、冷却、品質検査、包装の4つです。
3. 「保存」ボタンをクリック
4. ✅ **確認**: サイドバーに「プロセス: コーヒー豆の焙煎・包装プロセス」が表示される

---

### ✅ タブ2: 機能カテゴリ抽出

1. タブ2「ステップ2: 機能カテゴリ」を開く
2. 「🚀 カテゴリを自動生成」ボタンをクリック
3. ✅ **確認**: 3-8個のカテゴリが生成される
4. ✅ **確認**: カテゴリ名が表示される（例: 焙煎工程、冷却工程、品質検査工程、包装工程）
5. ✅ **確認**: サイドバーに「カテゴリ数: X」が表示される

**期待される結果例**:
- 焙煎工程
- 冷却工程
- 品質検査工程
- 包装工程

---

### ✅ タブ3: ノード定義

1. タブ3「ステップ3: ノード定義」を開く
2. 「AI主導対話」モードを選択
3. 各カテゴリについて：
   - 「🤖 AI対話を開始」ボタンをクリック
   - 対話を進める（または「🚀 IDEF0ノードを抽出」ボタンで一括抽出）
4. ✅ **確認**: 各カテゴリでInput, Mechanism, Outputが定義される
5. ✅ **確認**: サイドバーに「ノード数: X」が表示される（12-20ノード推奨）

**期待される結果例（焙煎工程）**:
- **Input**: 生コーヒー豆
- **Mechanism**: 焙煎機、温度制御システム
- **Output**: 焙煎済みコーヒー豆

---

### ✅ タブ4: ノード影響評価

1. タブ4「ステップ4: ノード影響評価」を開く
2. **ステップ1**: 「🔄 評価ペアを生成」ボタンをクリック
3. ✅ **確認**: 削減率が80-90%と表示される
4. ✅ **確認**: 必須評価ペア数が表示される（例: 150件）
5. **ステップ2**: 「📊 全フェーズを一括評価」ボタンをクリック
6. ✅ **確認**: プログレスバーが表示される
7. ✅ **確認**: LLMが各カテゴリのペアを評価する
8. **ステップ3**: 評価結果を確認
9. ✅ **確認**: 非ゼロペア数と疎行列率が表示される
10. ✅ **確認**: 高スコアペア一覧が表示される

**期待される結果**:
- 疎行列率: 80-95%
- 非ゼロペア: 50-150件
- 高スコアペア（|score| ≥ 5）: 10-30件

---

### ✅ タブ5: 行列分析

1. タブ5「ステップ5: 行列分析」を開く
2. 「📊 隣接行列を生成」ボタンをクリック
3. ✅ **確認**: ヒートマップが表示される
4. ✅ **確認**: 日本語が正しく表示される（文字化けなし）
5. ✅ **確認**: 軸ラベルに「To Node」「From Node」が表示される
6. ✅ **確認**: 高次数ノード（粒度調整提案）が表示される

**期待される結果**:
- ヒートマップが正しく表示される
- 非ゼロ要素が視覚的に識別できる
- 高次数ノード（入次数 > 5 または 出次数 > 5）が検出される

---

### ✅ タブ6: ネットワーク可視化

1. タブ6「ステップ6: ネットワーク可視化」を開く
2. **3D可視化（NetworkMaps）**:
   - 「🌐 3D可視化を表示」ボタンをクリック
   - ✅ **確認**: 3D空間にノードとエッジが表示される
   - ✅ **確認**: Output（緑）、Mechanism（青）、Input（オレンジ）の色分け
   - ✅ **確認**: マウスで回転・ズーム可能
3. **2D可視化（Cytoscape）**:
   - 「🔄 2D可視化を表示」ボタンをクリック
   - レイアウトを選択（hierarchical推奨）
   - ✅ **確認**: 2Dグラフが表示される
   - ✅ **確認**: ノードをドラッグ可能

**期待される結果**:
- 3D/2D両方の可視化が正常に表示される
- IDEF0構造に基づいた配置
- エッジの太さがスコアに比例

---

### ✅ タブ7: ネットワーク分析

1. タブ7「ステップ7: ネットワーク分析」を開く
2. 「📈 ネットワーク分析を実行」ボタンをクリック
3. ✅ **確認**: PageRankスコアが表示される
4. ✅ **確認**: 中心性指標（Degree, Betweenness, Closeness）が表示される
5. ✅ **確認**: 上位ノードランキングが表示される
6. ✅ **確認**: 粒度調整提案（PageRank高・Betweenness高のノード）が表示される

**期待される結果**:
- PageRank上位3ノードが検出される
- 重要なボトルネックノードが特定される
- 粒度調整の推奨ノードが提案される

---

### ✅ タブ8: DSM最適化

1. タブ8「ステップ8: DSM最適化」を開く
2. **DSM設定**:
   - 「🤖 LLMによる自動評価（推奨）」を選択
   - 「🤖 パラメータをLLMで評価」ボタンをクリック
   - ✅ **確認**: LLMがパラメータ（Cost, Range, Importance, Structure）を評価
   - ✅ **確認**: 評価結果がテーブル表示される
3. **STEP-1: 設計パラメータ選択**:
   - 「🚀 STEP-1を実行（パラメータ選択）」ボタンをクリック
   - ✅ **確認**: パレートフロント2D散布図が表示される
   - ✅ **確認**: 複数の解（10-100個）が表示される
   - 1つの解を選択
4. **STEP-2: 依存関係方向決定**:
   - 「🚀 STEP-2を実行（依存関係最適化）」ボタンをクリック
   - ✅ **確認**: パレートフロント3D散布図が表示される
   - ✅ **確認**: 調整困難度・競合困難度・ループ困難度が計算される
   - 1つの解を選択
5. **最適化DSM**:
   - ✅ **確認**: 最適化後のDSMヒートマップが表示される
   - ✅ **確認**: 削除されたノード一覧が表示される

**期待される結果**:
- STEP-1: コスト vs 自由度のトレードオフが可視化される
- STEP-2: 3つの困難度指標のトレードオフが可視化される
- 最適化DSM: 元の行列よりも疎で構造化されている

---

### ✅ データエクスポート/インポート

1. サイドバーの「📤 エクスポート」を展開
2. **Excelエクスポート**:
   - 「Excel (.xlsx)」を選択
   - 「エクスポート実行」ボタンをクリック
   - ✅ **確認**: Excelファイルがダウンロードされる
   - ✅ **確認**: 6シート（プロジェクト情報、カテゴリ、IDEF0、行列、評価、ノード）が含まれる
3. **JSONエクスポート**:
   - 「JSON (.json)」を選択
   - 「エクスポート実行」ボタンをクリック
   - ✅ **確認**: JSONファイルがダウンロードされる
4. **インポート**:
   - サイドバーの「📥 インポート」を展開
   - エクスポートしたファイルをアップロード
   - ✅ **確認**: データが正しく復元される
   - ✅ **確認**: 全タブで以前のデータが表示される

---

## 確認結果の記録

各ステップの確認結果を記録してください：

| タブ | 項目 | 結果 | 備考 |
|------|------|------|------|
| タブ1 | プロセス定義保存 | ☐ OK / ☐ NG | |
| タブ2 | カテゴリ生成 | ☐ OK / ☐ NG | |
| タブ3 | IDEF0ノード定義 | ☐ OK / ☐ NG | |
| タブ4 | ペア生成・評価 | ☐ OK / ☐ NG | |
| タブ5 | ヒートマップ表示 | ☐ OK / ☐ NG | |
| タブ6 | 3D/2D可視化 | ☐ OK / ☐ NG | |
| タブ7 | ネットワーク分析 | ☐ OK / ☐ NG | |
| タブ8 | DSM最適化 | ☐ OK / ☐ NG | |
| データ | エクスポート/インポート | ☐ OK / ☐ NG | |

---

## トラブルシューティング

### LLMエラーが発生する場合

- OpenAI APIキーが設定されているか確認
- `.streamlit/secrets.toml` に `OPENAI_API_KEY = "sk-..."` が存在するか確認
- APIクォータが残っているか確認

### 可視化が表示されない場合

- `NETWORKMAPS_RELEASE=true` 環境変数が設定されているか確認
- フロントエンドがビルド済みか確認（`components/*/frontend/build/` ディレクトリ存在）
- ブラウザのコンソールエラーを確認

### ヒートマップで日本語が文字化けする場合

- matplotlib日本語フォント設定を確認
- タブ5のコードで `rcParams['font.sans-serif']` が設定されているか確認

---

## 完了条件

以下の全てが「OK」であれば、アプリケーションは正常に動作しています：

- ✅ タブ1-8まで全てのステップが完了
- ✅ データフローが正しく機能（タブ1→8）
- ✅ LLM統合が動作（カテゴリ生成、ノード評価、パラメータ評価）
- ✅ 可視化が正常表示（ヒートマップ、3D、2D）
- ✅ DSM最適化が実行される（STEP-1, STEP-2）
- ✅ エクスポート/インポートが動作

---

**テスト実施日**: __________

**テスト実施者**: __________

**総合評価**: ☐ 合格 / ☐ 不合格

**コメント**:
